
<!DOCTYPE html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>Snake SVG</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width">
	<style>
	body {
	font-family: "Trebuchet MS";
	}
	
	h1 {
	text-align: center;
	}
	
	h2 {
	text-align: center;
	color: lightgray;
	}
	
	h3 {
	width: 750px;
	text-align: center;
	margin-left: auto;
	margin-right: auto;
	}
	
	a {
	text-decoration: none;
	}
	
	svg{
	border: 2px solid;
	}
	
	#svg_holder{
	width=525px;
	text-align: center;
	margin-left: auto;
	margin-right: auto;
	}
	
	p{
	text-align: center;
	margin-left: auto;
	margin-right: auto;
	font-weight: bold;
	font-size: 20px;
	color: steelblue;
	}
	</style>
</head>
<body>
	<h1> Snake </h1>
	<h2> (An SVG Approach) </h2>
	<h3>
	Below is my implementation of Snake using SVG to render graphics. 
	The library <a href="http://d3js.org">d3</a> is used to help
	manipulate the SVG elements. I chose it simply because I had previous
	experience with it and found it convenient. Feel free to read more 
	about this project <a href="http://sandeepba.github.io/javascript-snake/">here</a>.
	</h3>
	<p>Score: <span id="score">0</span></p>
	<div id="svg_holder">
	</div>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script>
//Globals
var svg,
	game_timer,
	food;

var game_over = false;
var tail = 0;	
var score = 4;
var snake = [[208,256],[224,256],[240,256],[256,256]];
var dir = {'coord':'x','change':16,'name':'right'};

//Establish Some Controls
document.onkeydown = checkKey;
function checkKey(e) {
    e = e || window.event;
    if (e.keyCode == '38'){//up
		if (dir.currentcoord == 'y'){
		return
		}
		dir.coord = 'y';
		dir.change = -16;
    }
    else if (e.keyCode == '40'){//down
        if (dir.currentcoord == 'y'){
		return
		}
		dir.coord = 'y';
		dir.change = 16;
    }
	else if (e.keyCode == '37'){//left
        if (dir.currentcoord == 'x'){
		return
		}
		dir.coord = 'x';
		dir.change = -16;
    }
	else if (e.keyCode == '39'){//right
        if (dir.currentcoord == 'x'){
		return
		}
		dir.coord = 'x';
		dir.change = 16;
    }
	else if (e.keyCode == '16'){//r
		if (game_over){
		console.log('1')
		location.reload();
		}
	}
}

//Create the SVG
function init_svg(){
	svg = d3.select('#svg_holder').append('svg')
		.attr('height',512)
		.attr('width',512);

	svg.selectAll('rect')
		.data([[208,256],[224,256],[240,256],[256,256]])
		.enter()
		.append('rect')
			.attr('x',function(d,i){return d[0]})
			.attr('y',function(d,i){return d[1]})
			.attr('width',16)
			.attr('height',16)
			.classed('snake',true);
	}
	
//Other Functions
function init_game_loop(){
	game_timer = setInterval(function(){update()},150);
	}

function update(){
	//Add New Location to Snake Array
	if (dir.coord == 'x'){
		snake.push([snake[snake.length - 1][0]+dir.change,snake[snake.length - 1][1]])
	}
	else{
		snake.push([snake[snake.length - 1][0],snake[snake.length - 1][1]+dir.change])
	}
	
	
	//Check for collisions
	if(
	((snake[snake.length-1][0]<=-8)||
	(snake[snake.length-1][0]>=512))
	||
	((snake[snake.length-1][1]<=-8)||
	(snake[snake.length-1][1]>=512))
	){
	end_game()
	return
	}
	//Self Collision	
	if(
	(snake[snake.length-1][0] == Number(food.attr('x')))
	&& (snake[snake.length-1][1] == Number(food.attr('y')))
	){
	food.attr('fill','black').attr('class','snake');
	score += 1;
	make_food();
	d3.select('#score').text(score - 4);
	}
	
	snake.slice(snake.length-score,snake.length-1).forEach(function(e,i,a){
		if(
		(e[0]==snake[snake.length-1][0])&&(e[1]==snake[snake.length-1][1])
		){
		end_game();
		}
	})
	
	//Move the Last Block of Snake to Front (put tail in front of head)
	//This is less expensive than redrawing everything
	d3.selectAll('rect.snake')[0][tail].setAttribute('x',snake[snake.length - 1][0]);
	d3.selectAll('rect.snake')[0][tail].setAttribute('y',snake[snake.length - 1][1]);
	dir.currentcoord = dir.coord;
	tail += 1;
	if (tail==score){
	tail = 0;
	}
	}
	
function make_food(){
	var min = 1;
	var max = 31;
	food = svg.append('rect')
			.attr('x',Math.floor(Math.random()*(max-min+1)+min)*16)
			.attr('y',Math.floor(Math.random()*(max-min+1)+min)*16)
			.attr('width',16)
			.attr('height',16)
			.attr('class','food')
			.attr('fill','gold');
	}

function end_game(){
	clearTimeout(game_timer);
	d3.selectAll('rect.snake').attr('fill','red');
	game_over = true;
	svg.append('text')
		.attr('x',200)
		.attr('y',250)
		.text('Press Shift to restart.')
	return
	}
	
//Main
function start(){
	game_over = false;
	init_svg()
	init_game_loop()
	make_food()
	}
	
start()
</script>
</body>